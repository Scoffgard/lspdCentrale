<header>
    <h1 class="fullsize">GÃ©nÃ©rateur de centrale</h1>
    <h2 class="mobile">GÃ©nÃ©rateur de centrale</h2>
    <div>
        <span class="fullsize">
            <div (click)="activePage = 'infos'"><p *ngIf="activePage == 'infos'; else nInfos"><u>Informations</u></p><ng-template #nInfos><p>Informations</p></ng-template></div>
            <div (click)="activePage = 'patrols'"><p *ngIf="activePage == 'patrols'; else nPatrols"><u>Patrouilles</u></p><ng-template #nPatrols><p>Patrouilles</p></ng-template></div>
            <div (click)="activePage = 'sReports'"><p *ngIf="activePage == 'sReports'; else nSReports"><u>Rapports de situation</u></p><ng-template #nSReports><p>Rapports de situation</p></ng-template></div>
            <div (click)="activePage = 'save'"><p *ngIf="activePage == 'save'; else nSave"><u>Sauvegarde</u></p><ng-template #nSave><p>Sauvegarde</p></ng-template></div>
        </span>
        <span class="mobile">
            <img src="./assets/menu-24px.svg" (click)="menuOpen = true"/>
        </span>
    </div>
</header>

<span id="mobileMenu" class="menu" *ngIf="menuOpen" (click)="menuOpen = false"></span>
<span class="menuContent" *ngIf="menuOpen">
    <span class="toolbar">
        <img src="./assets/close-24px.svg" (click)="menuOpen = false"/>
        <h2>Menu</h2>
    </span>
    <div (click)="activePage = 'infos'"><p *ngIf="activePage == 'infos'; else nInfos"><u>Informations</u></p><ng-template #nInfos><p>Informations</p></ng-template></div>
    <div (click)="activePage = 'patrols'"><p *ngIf="activePage == 'patrols'; else nPatrols"><u>Patrouilles</u></p><ng-template #nPatrols><p>Patrouilles</p></ng-template></div>
    <div (click)="activePage = 'sReports'"><p *ngIf="activePage == 'sReports'; else nSReports"><u>Rapports de situation</u></p><ng-template #nSReports><p>Rapports de situation</p></ng-template></div>
    <div (click)="activePage = 'save'"><p *ngIf="activePage == 'save'; else nSave"><u>Sauvegarde</u></p><ng-template #nSave><p>Sauvegarde</p></ng-template></div>

    <span class="github">
        <img src="./assets/GitHub-Mark-Light-32px.png"/>
        <h3><a target="_blank" href="https://github.com/Scoffgard/lspdCentrale" style="text-decoration: none; color: #eee">GitHub</a></h3>
    </span>
</span>




<div class="helpPageTrigger" (click)="activePage = activePage.substring(4)" *ngIf="activePage.substring(0, 4) == 'help'; else nHelp">
    <u>Aide</u>&nbsp;<img src="./assets/help_outline-24px.svg" />
</div>
<ng-template #nHelp>
    <div class="helpPageTrigger" (click)="activePage = 'help' + activePage">
        Aide <img src="./assets/help_outline-24px.svg" />
    </div>
</ng-template>


<span [class]="menuOpen == true ? 'hideOverflow' : null">
    <div id="helpInfos" class="content help" *ngIf="activePage == 'helpinfos'">
        <img src="./assets/helpInfos.png"/><br /><br />
        <h2>*1</h2><p>Contient l'heure de dÃ©but de la centrale qui correspond Ã  l'heure d'ouverture de la page. Pensez donc Ã  recharger la page Ã  chaque nouvelle centrale !</p><br />
        <h2>*2</h2><p>Contient les informations sur les diffÃ©rents membres proposÃ©s. D'abord le grade, ensuite l'ID (ex: 1924) et le PrÃ©nom et NOM (ex: Antoine CUMSI).</p><br />
        <h2>*3</h2><p>Contient le rÃ©sultat final du rapport de centrale. C'est ce texte que vous devez copier et coller sur le panel Ã  la fin de votre rapport. Le texte entre parenthÃ¨ses ne doit pas Ãªtre enlevÃ©, sous peine de bannissement de l'outil.</p>
    </div>

    <div id="helpPatrols" class="content help" *ngIf="activePage == 'helppatrols'">
        <img src="./assets/helpPatrols.png"/><br /><br />
        <h2>*1</h2><p>Permet de crÃ©er une nouvelle patrouille. Le menu dÃ©roulant de gauche permet de choisir le type. Et le bouton de valider la crÃ©ation.</p><br />
        <h2>*2</h2><p>Ces boutons sont propres Ã  chaque patrouille. Le bouton 'Dissoudre' permet de dissoudre la patrouille. Se proposera alors une zone texte oÃ¹ entrer la raison de la dissolution. Le bouton 'Supprimer' permet de supprimer totalement la patrouille en cas de click par erreur. Ce bouton n'apparaÃ®t que sur la derniÃ¨re patrouille du type. Alors, attention !</p><br />
        <h2>*3</h2><p>Le sÃ©lecteur permet de choisir un secteur pour la patrouille. Il n'apparaÃ®t toutefois que sur les patrouilles applicables. Le 'plus' permet d'ajouter un secteur pour assigner de multiples secteurs Ã  la patrouille.</p><br />
        <h2>*4</h2><p>Ce bouton permet tout simplement d'ajouter un membre Ã  la patrouille.</p><br />
        <h2>*5, case 1</h2><p>Contient les informations sur le membre. D'abord le grade, ensuite l'ID (ex: 1924) et le PrÃ©nom et NOM (ex: Antoine CUMSI). Les deux boutons fonctionnent exactement comme dans *2, mis a part que 'Dissoudre' est remplacÃ© par 'DÃ©part'.</p><br />
        <h2>*5, case 2</h2><p>AprÃ¨s l'appui sur 'DÃ©part', cette case apparaÃ®t sous le membre sÃ©lectionnÃ©. Elle permet de dÃ©finir un dÃ©part et une raison pour.</p>
    </div>

    <div id="helpSReports" class="content help" *ngIf="activePage == 'helpsReports'">
        <img src="./assets/helpSReports.png"/><br /><br />
        <h2>*1</h2><p>Ce bouton permet de crÃ©er un nouveau rapport de situation. Il vous est aussi fourni l'heure suggÃ©rÃ©e pour le prochain rapport (toutes les 15 minutes).</p><br />
        <h2>*2</h2><p>Pour chaque rapport apparaÃ®t une liste avec toutes les patrouilles actives Ã  l'heure du rapport. La zone de texte permet de dÃ©finir le statut de la patrouille (ex: R.A.S.).</p>
    </div>

    <div id="helpSave" class="content help" *ngIf="activePage == 'helpsave'">
        <img src="./assets/helpSave.png"/><br /><br />
        <h2>*1</h2><p>Cette zone de texte contient les donnÃ©es de sauvegarde de la centrale en cours. A copier souvent en cas malencontreux de 'F5' ;) . Vous pouvez aussi coller d'autres donnÃ©es dans cette case, aprÃ¨s rechargement de la page par exemple.</p><br />
        <h2>*2</h2><p>Ces deux boutons permettent le traitement des donnÃ©es. 'Charger' permet de mettre la zone de texte Ã©gale aux donnÃ©es de sauvegarde actuel (il faut le faire mÃªme aprÃ¨s avoir changÃ© d'onglet). 'Envoyer' permet de traiter les donnÃ©es que vous auriez pu coller dans la zone texte et de restaurer la sauvegarde.</p>
    </div>

    <div id="infos" class="content" *ngIf="activePage == 'infos'">
        <h1>Centrale de {{infos.startedAt}}</h1>
        <br />
        <div *ngFor="let agent of infos.agents">
            <h2>{{agent.roleName}} :</h2>
            <br />
            <select (change)="agent.rank = $event.target.value" [value]="agent.rank"><option *ngFor="let rank of ranks">{{rank}}</option></select>&nbsp;<input type="text" placeholder="ID" (change)="agent.id = $event.target.value" [value]="agent.id" style="width: 2.6em;"/> | <input type="text" [value]="agent.name" placeholder="PrÃ©nom NOM" (change)="agent.name = $event.target.value"/>
            <br /><br />
        </div>
        <h2>Rapport : </h2><br />
        <div class="report">
            <p>
                ğŸ“‹ RAPPORT DE CENTRALE ğŸ“‹ ( Fait avec l'outil de centrale d'Antoine CUMSI : https://www.teo-m.tk/centrale )<br /> 
                ğŸ‘®â€ CENTRALE : {{(infos.agents[1].rank).toUpperCase()}} {{infos.agents[1].id}} | {{infos.agents[1].name}}<br />
                ğŸš© DÃ©but Ã  {{infos.startedAt}}<br />
                â Fin Ã  <i>A REMPLIR</i> - ğŸ‘„ Raison : <i>A REMPLIR</i><br /><br />
    
                ğŸ‘®â€ CHEF DU DISPATCH : {{(infos.agents[0].rank).toUpperCase()}} {{infos.agents[0].id}} | {{infos.agents[0].name}}<br />
                ğŸ‘®â€ ACCUEIL : {{(infos.agents[2].rank).toUpperCase()}} {{infos.agents[2].id}} | {{infos.agents[2].name}}<br /><br />
    
                ğŸš¨ PATROUILLES ğŸš¨<br /><br />
                <span *ngFor="let pType of patrolTypes; let i = index">
                    <p *ngFor="let patrol of patrols[pType]">
                        {{patrolTypesEmoji[i]}} {{patrol.name}} | ğŸš© CrÃ©Ã©e Ã  {{patrol.startedAt}} <span *ngIf="!patrol.on">| â Dissoute Ã  {{patrol.end.hour}} - ğŸ‘„ Raison : {{patrol.end.reason}}</span><br />
                        ğŸ—ºï¸ Secteur <span *ngFor="let sector of patrol.sectors">{{sector.toUpperCase()}} </span><br />
                        <span *ngFor="let member of patrol.members">
                            ğŸ‘® {{(member.rank).toUpperCase()}} {{member.id}} | {{member.name}}<span *ngIf="compareHour(patrol.startedAt, member.addedAt, 2)"> | â• Ajout Ã  {{member.addedAt}}</span><span *ngIf="member.leave.reason != undefined"> | â DÃ©part Ã  {{member.leave.hour}} - ğŸ‘„ Raison : {{member.leave.reason}}</span><br />
                        </span><br />
                    </p>
                </span>
    
                ğŸ“ RAPPORTS DE SITUATION ğŸ“<br /><br />
                <span *ngFor="let report of sReports">
                    ğŸ• {{report.hour}} :<br />
                    <span *ngFor="let patrol of report.patrols">
                        {{patrolTypesEmoji[patrol.typeNb]}} {{patrol.name}} : {{patrol.value}}<br />
                    </span><br />
                </span>
    
            </p>
        </div>
        <br />
    </div>
    
    <div id="patrols" class="content patrols" *ngIf="activePage == 'patrols'">
        <select (change)="activePatrolType = $event.target.value"><option *ngFor="let pType of patrolTypes">{{pType}}</option></select>&nbsp;<button (click)="newPatrol()">Nouvelle Patrouille</button>
        <br /><br />
        <div *ngFor="let pType of patrolTypes">
            <div *ngFor="let patrol of patrols[pType]; let patrolI = index">
                <h2 style="margin-bottom: 10px;">{{patrol.name}}</h2>
                <button (click)="stopPatrol(pType, patrol)">Dissoudre</button>&nbsp;
                <button *ngIf="patrols[pType][patrolI+1] == undefined" (click)="removeLastPatrol(pType)">Supprimer</button>
                <input *ngIf="!patrol.on" type="text" (change)="patrol.end.reason = $event.target.value" [value]="patrol.end.reason" placeholder="Raison"/>
                <div id="sectors" *ngIf="pType != 'PN' && pType != 'PB' && pType != 'PH'" style="margin-top: 10px;">&nbsp;Secteur : <select (change)="patrol.sectors[i] = $event.target.value" *ngFor="let sector of patrol.nbOfSectors; let i = index" style="margin-right: 0.5em;"><option *ngFor="let sectorOption of sectors" [value]="sectorOption" [selected]="sectorOption == patrol.sectors[i]">{{sectorOption}}</option></select><img src="./assets/add-24px.svg" (click)="addSector(pType, patrol)" /></div>
                <br />
                <button (click)="addMember(pType, patrol)">Nouveau Membre</button>
                <br /><br />
                <div *ngFor="let member of patrol.members; let memberI = index">
                    <div><select (change)="member.rank = $event.target.value" [value]="member.rank"><option *ngFor="let rank of ranks" [value]="rank" [selected]="rank == member.rank">{{rank}}</option></select>&nbsp;<input type="text" placeholder="ID" [value]="member.id" (change)="member.id = $event.target.value" style="width: 2.6em;"/> | <input type="text" (change)="member.name = $event.target.value" [value]="member.name" placeholder="PrÃ©nom NOM"/>&nbsp;<button *ngIf="patrol.members[memberI+1] == undefined" (click)="removeLastMember(pType, patrol)">Supprimer</button>&nbsp;<button (click)="removeMember(pType, patrol, member)">DÃ©part</button></div>
                    <div style="margin-top: 5px;" *ngIf="member.leave.reason != undefined">&nbsp;DÃ©part Ã  {{member.leave.hour}}, car : <input type="text" [value]="member.leave.reason" placeholder="Raison" (change)="member.leave.reason = $event.target.value" /></div>
                    <br />
                </div>
                <br />
            </div>
        </div>
    </div>
    
    <div id="save" class="content" *ngIf="activePage == 'save'">
        <h2>DonnÃ©es de sauvegarde</h2><br /><br />
        <textarea rows="15" cols="40" [value]="save" (change)="save = $event.target.value"></textarea><br />
        <button (click)="loadSave()">Charger</button><br />
        <button (click)="submitSave()">Envoyer</button>
        <span class="github fullsize">
            <a target="_blank" href="https://github.com/Scoffgard/lspdCentrale" style="text-decoration: none; color: #eee"><img src="./assets/GitHub-Mark-Light-32px.png" /></a>
            <h3><a target="_blank" href="https://github.com/Scoffgard/lspdCentrale" style="text-decoration: none; color: #eee">GitHub</a></h3>
        </span>
    </div>
    
    <div id="sReports" class="content" *ngIf="activePage == 'sReports'">
        <button (click)="newSReport()" style="margin-bottom: 5px;">Nouveau Rapport</button><br />
        &nbsp;Heure suggÃ©rÃ©e du prochain rapport : {{getNextReportHour()}}
        <div *ngFor="let report of sReports">
            <br />
            <h2>{{report.hour}} :</h2>
            <div *ngFor="let patrol of report.patrols; let i = index">
                {{patrol.name}} : <input type="text" (change)="report.patrols[i].value = $event.target.value" [value]="patrol.value" placeholder="Statut" />
            </div>
        </div>
    </div>

    
</span>
